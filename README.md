# Jimeng MCP 服务器

使用TypeScript实现的Model Context Protocol (MCP) 服务器项目，集成了火山引擎的即梦AI图像生成服务。

## 功能

- 基于TypeScript构建
- 使用tsup作为构建工具
- 实现了MCP协议，支持标准的stdio通信
- 集成火山引擎的即梦AI图像生成服务
- 提供图像生成工具
- 使用@volcengine/openapi进行API调用

## 安装

```bash
# 使用yarn安装依赖
yarn install
```

## 环境配置

在MCP客户端配置（如Claude Desktop）中设置以下环境变量：

```json
{
  "mcpServers": {
    "jimeng": {
      "command": "node",
      "args": ["lib/index.js"],
      "cwd": "/path/to/jimeng-mcp",
      "env": {
        "VOLCENGINE_ACCESS_KEY": "your_access_key_here",
        "VOLCENGINE_SECRET_KEY": "your_secret_key_here"
      }
    }
  }
}
```

## 开发

```bash
# 开发模式运行
yarn dev

# 使用nodemon开发并自动重启
yarn start:dev
```

## 构建

```bash
# 构建项目
yarn build
```

## 运行

```bash
# 启动服务器
yarn start

# 测试MCP服务器
yarn test
```

## Claude Desktop 配置示例

以下是在Claude Desktop中配置此MCP服务器的完整示例:

```json
{
  "mcpServers": {
    "jimeng": {
      "command": "node",
      "args": ["/path/to/jimeng-mcp/lib/index.js"],
      "env": {
        "VOLCENGINE_ACCESS_KEY": "your_access_key_here",
        "VOLCENGINE_SECRET_KEY": "your_secret_key_here"
      }
    }
  }
}
```

## 即梦AI图像生成

本MCP服务器集成了火山引擎的即梦AI图像生成功能，提供图像生成工具：

`generateImage` - 提交图像生成请求并直接返回图像URL
- 参数：
  - `prompt`：生成图像的文本描述（必填）
  - `req_key`：模型名称，固定值："jimeng_high_aes_general_v21_L"（已设默认值）
  - `width`：图像宽度，默认值：512（可选）
  - `height`：图像高度，默认值：512（可选）
  - `seed`：随机种子，默认值：-1（可选）
  - `use_sr`：文生图+AIGC超分（可选，布尔值，默认true）
  - `use_pre_llm`：开启文本扩写，针对输入prompt进行扩写优化（可选，布尔值，默认true）
  - `return_url`：输出是否返回图片链接，链接有效期为24小时（可选，默认为true）
  - `logo_info`：水印信息（可选，对象）
    - `add_logo`：是否添加水印，默认不添加（可选，布尔值）
    - `position`：水印位置，0-右下角 1-左下角 2-左上角 3-右上角（可选，数字）
    - `language`：水印语言，0-中文(AI生成) 1-英文(Generated by AI)（可选，数字）
    - `opacity`：水印透明度，范围0-1，默认0.3（可选，数字）
    - `logo_text_content`：水印文字内容（可选，字符串）

### 技术实现

- 使用`@volcengine/openapi`库进行API调用
- 基于面向对象设计，将API实现封装为类
- 直接返回图像URL，无需额外查询任务结果

### 使用示例

通过MCP协议调用图像生成功能：

```javascript
// 生成图像
client.callTool({
  name: "generateImage",
  arguments: {
    prompt: "一只可爱的猫咪在草地上",
    width: 512,
    height: 512,
    use_pre_llm: true,
    return_url: true,
    logo_info: {
      add_logo: true,
      position: 0,
      language: 0,
      opacity: 0.5
    }
  }
});
```

## 响应格式

API将直接返回生成的图像URL数组，可以直接在各类客户端中显示：

```javascript
[
  "https://example.com/generated-image-1.jpg",
  "https://example.com/generated-image-2.jpg"
]
```

## 资源

服务器还提供了以下信息资源：

- `greeting://{name}` - 提供个性化问候
- `info://server` - 提供服务器基本信息
- `jimeng-ai://info` - 提供即梦AI图像生成服务的使用说明

## 许可证

MIT 